generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum Role {
  USER
  ADMIN
  HOTEL_OWNER
}

enum BookingStatus {
  PENDING
  CONFIRMED
  CANCELLED
  COMPLETED
}

enum PaymentStatus {
  PENDING
  SUCCEEDED
  FAILED
  REFUNDED
}

model User {
  id            String    @id @default(uuid())
  email         String    @unique
  password      String
  firstName     String    @map("first_name")
  lastName      String    @map("last_name")
  phone         String?
  avatar        String?
  role          Role      @default(USER)
  refreshToken  String?   @map("refresh_token")
  createdAt     DateTime  @default(now()) @map("created_at")
  updatedAt     DateTime  @updatedAt @map("updated_at")

  bookings      Booking[]
  reviews       Review[]

  @@map("users")
}

model Hotel {
  id            String    @id @default(uuid())
  name          String
  slug          String    @unique
  description   String?
  address       String
  city          String
  country       String
  latitude      Float?
  longitude     Float?
  stars         Int       @default(0)
  rating        Float     @default(0)
  reviewCount   Int       @default(0) @map("review_count")
  amenities     String[]  @default([])
  images        String[]  @default([])
  contactEmail  String?   @map("contact_email")
  contactPhone  String?   @map("contact_phone")
  isActive      Boolean   @default(true) @map("is_active")
  createdAt     DateTime  @default(now()) @map("created_at")
  updatedAt     DateTime  @updatedAt @map("updated_at")

  rooms         Room[]
  reviews       Review[]

  @@index([city])
  @@index([country])
  @@index([rating])
  @@index([stars])
  @@map("hotels")
}

model Room {
  id            String             @id @default(uuid())
  hotelId       String             @map("hotel_id")
  name          String
  description   String?
  type          String
  price         Float
  currency      String             @default("USD")
  maxGuests     Int                @default(2) @map("max_guests")
  amenities     String[]           @default([])
  images        String[]           @default([])
  isActive      Boolean            @default(true) @map("is_active")
  createdAt     DateTime           @default(now()) @map("created_at")
  updatedAt     DateTime           @updatedAt @map("updated_at")

  hotel         Hotel              @relation(fields: [hotelId], references: [id], onDelete: Cascade)
  availability  RoomAvailability[]
  bookings      Booking[]

  @@index([hotelId])
  @@index([price])
  @@index([type])
  @@map("rooms")
}

model RoomAvailability {
  id            String    @id @default(uuid())
  roomId        String    @map("room_id")
  date          DateTime  @db.Date
  isAvailable   Boolean   @default(true) @map("is_available")
  price         Float?
  createdAt     DateTime  @default(now()) @map("created_at")
  updatedAt     DateTime  @updatedAt @map("updated_at")

  room          Room      @relation(fields: [roomId], references: [id], onDelete: Cascade)

  @@unique([roomId, date])
  @@index([date])
  @@index([isAvailable])
  @@map("room_availability")
}

model Booking {
  id            String        @id @default(uuid())
  userId        String        @map("user_id")
  roomId        String        @map("room_id")
  checkIn       DateTime      @map("check_in") @db.Date
  checkOut      DateTime      @map("check_out") @db.Date
  guests        Int           @default(1)
  totalPrice    Float         @map("total_price")
  currency      String        @default("USD")
  status        BookingStatus @default(PENDING)
  specialRequests String?     @map("special_requests")
  createdAt     DateTime      @default(now()) @map("created_at")
  updatedAt     DateTime      @updatedAt @map("updated_at")

  user          User          @relation(fields: [userId], references: [id])
  room          Room          @relation(fields: [roomId], references: [id])
  payment       Payment?

  @@index([userId])
  @@index([roomId])
  @@index([status])
  @@index([checkIn, checkOut])
  @@map("bookings")
}

model Payment {
  id              String        @id @default(uuid())
  bookingId       String        @unique @map("booking_id")
  transactionId   String?       @unique @map("transaction_id")
  amount          Float
  currency        String        @default("USD")
  status          PaymentStatus @default(PENDING)
  method          String?       @default("lianlian_bank")
  createdAt       DateTime      @default(now()) @map("created_at")
  updatedAt       DateTime      @updatedAt @map("updated_at")

  booking         Booking       @relation(fields: [bookingId], references: [id])

  @@index([status])
  @@map("payments")
}

model Review {
  id            String    @id @default(uuid())
  userId        String    @map("user_id")
  hotelId       String    @map("hotel_id")
  rating        Int
  title         String?
  comment       String?
  createdAt     DateTime  @default(now()) @map("created_at")
  updatedAt     DateTime  @updatedAt @map("updated_at")

  user          User      @relation(fields: [userId], references: [id])
  hotel         Hotel     @relation(fields: [hotelId], references: [id], onDelete: Cascade)

  @@unique([userId, hotelId])
  @@index([hotelId])
  @@index([rating])
  @@map("reviews")
}
